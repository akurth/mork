<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;6.&nbsp;Compiling</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"><link rel="home" href="manual.html" title="Mork"><link rel="up" href="manual.html" title="Mork"><link rel="prev" href="ch05.html" title="Chapter&nbsp;5.&nbsp;Mapper files"><link rel="next" href="ch07.html" title="Chapter&nbsp;7.&nbsp;Usage"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;6.&nbsp;Compiling</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch05.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch07.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter&nbsp;6.&nbsp;Compiling"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2665"></a>Chapter&nbsp;6.&nbsp;Compiling</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="ch06.html#d0e2676">Invocation</a></span></dt><dt><span class="sect1"><a href="ch06.html#d0e2754">Options</a></span></dt><dt><span class="sect1"><a href="ch06.html#d0e2809">Re-compiling</a></span></dt><dt><span class="sect1"><a href="ch06.html#d0e2816">Maven</a></span></dt></dl></div><p title="Overview"><b>Overview.&nbsp;</b>Mork generates mappers. Technically, this is done by translating ("compiling") mapper files
        into class files. The mapper file is supplied by the user, it specifies the mapping of input
        streams into Java objects as needed by the respective application. The generated class files are
        Java class files, they follow the same rules as class files generated by the Java compiler.
        Applications need these class files in their <code class="literal">CLASSPATH</code> to load and run
        mappers.</p><div class="sect1" title="Invocation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2676"></a>Invocation</h2></div></div></div><p title="Prerequisites"><b>Prerequisites.&nbsp;</b>Before running Mork, make sure to compile you Java source files. Mork checks classes
          referenced in mapper files to perform type checking. These classes have to be properly compile
          before running Mork: run <code class="literal">javac</code> on them. </p><p title="Invocation"><b>Invocation.&nbsp;</b><code class="literal">"mork" option* file*</code></p><p>Mork is similar to <code class="literal">javac</code>: the user specifies a list of options followed
        by a list of files to compile. Mork compiles the file in the given order.</p><p title="Example"><b>Example.&nbsp;</b><code class="literal">mork Foo.mapper</code> compiles the mapper file, loading it from the current working
          directory. A successful compilation results in a class file <code class="literal">Foo.class</code> (and some
          other class files <code class="literal">Foo*.class</code>).</p><p title="CLASSPATH"><b><code class="literal">CLASSPATH</code>.&nbsp;</b>When invoking Mork on a file <code class="literal">Foo.mapper</code>, the
          <code class="literal">CLASSPATH</code> has to contain all classes imported in the mapper file. For
          example, if <code class="literal">Foo.mapper</code> imports a class <code class="literal">mypkg.Bar</code>, this
          class has to be available via the <code class="literal">CLASSPATH</code> variable. Otherwise, Mork
          reports an error, indicating that the class <code class="literal">mypkg.Bar</code> is not defined.
        </p><p title="Memory consumption"><b>Memory consumption.&nbsp;</b>If Java runs out of memory (i.e. throws an
          <code class="literal">OutOfMemoryError</code>), use the Java <code class="literal">-Xmx</code> option in
          the launch script to increase the memory available to the virtual machine. Example
          <code class="literal">java -Xmx128M net.sf.beezle.mork.compiler.Main veryComplex.mork</code>.
        </p><p title="Command-line arguments vs. mapper files"><b>Command-line arguments vs. mapper files.&nbsp;</b>Mork is controlled by both mapper files command line options, but what setting
          is specified where?  Logical settings go into the mapper files, i.e. setting affecting what input
          is actually mapped into which object. The same mapper file always results in the same mapping, no
          matter what options have been specified on the command line.  Physical settings go into the
          command line: where the generated code is stored, or what additional output it generated. Or even
          - in future version - optimization settings. </p></div><div class="sect1" title="Options"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2754"></a>Options</h2></div></div></div><p>Options start with "-" followed by the option name. Options are
        case-sensitive. Currently available options:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p title="-help"><b><code class="literal">-help</code>.&nbsp;</b>Prints help about invoking Mork.</p></li><li class="listitem"><p title="-stat"><b><code class="literal">-stat</code>.&nbsp;</b>Prints statistics about mappers to standard output. Use this
            option to see the size of the generated finite automatons and pushdown
            automatons.</p></li><li class="listitem"><p title="-k <n&gt;"><b><code class="literal">-k &lt;n&gt;</code>.&nbsp;</b>Specifies the lookahead, the k in lr(k). Default is 1.</p></li><li class="listitem"><p title="-lst"><b><code class="literal">-lst</code>.&nbsp;</b>Generates listing files. If this option is given, Mork generates
            a listing of each compiled file. The listing includes a
            list of symbols, the mapper's grammar and the generated automatons
            and can get very long. The listing for a file <code class="literal">Foo.mapper</code> is written
            to the file <code class="literal">Foo.lst</code>. Use this option to find grammar conflicts.
          </p></li><li class="listitem"><p title="-d directory"><b><code class="literal">-d</code> directory.&nbsp;</b>Sets the destination directory for generated class files. If a mapper
            is part of a package, Mork puts the class files in a
            sub directory reflecting the package name, creating directories as needed.</p></li><li class="listitem"><p title="-verbose"><b><code class="literal">-verbose</code>.&nbsp;</b>Issues overall progress information to standard output. If compiling is slow,
            this option can be used to locate which part of the mapper generation is slow.
          </p></li></ul></div></div><div class="sect1" title="Re-compiling"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2809"></a>Re-compiling</h2></div></div></div><p>When do you have to re-run Mork? Nothing surprising here, the rules
        are similar to Java files and the Java compiler. A compiled mapper depends
        on its mapper file and the signature of the referenced constructors. Thus,
        re-compile a mapper if the mapper file (or the referenced syntax file) or
        the signature of at least on of the referenced constructors has changed. Note
        that changing a constructor without affecting the signature does not require
        a re-compile.</p><p>Class file analyzer tools see constructor references as normal Java call,
        no reflection is used. Thus, it is possible to use a to find class file dependencies.
      </p></div><div class="sect1" title="Maven"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2816"></a>Maven</h2></div></div></div><p>You'll usually use Maven to build your application. Here's the approriate
        configuration to invoke Mork on the file <code class="literal">src/main/Foo.mapper</code>.</p><pre class="programlisting">&lt;plugin&gt;
        &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.7&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;mork&lt;/id&gt;
            &lt;phase&gt;process-classes&lt;/phase&gt;
            &lt;configuration&gt;
              &lt;target&gt;
                &lt;java fork="true" dir="${basedir}" classname="net.sf.beezle.mork.compiler.Main" failonerror="true"&gt;
                  &lt;classpath&gt;
                    &lt;pathelement path="${basedir}/target/classes" /&gt;
                    &lt;path refid="maven.compile.classpath" /&gt;
                  &lt;/classpath&gt;
                  &lt;arg value="-d" /&gt;
                  &lt;arg path="${basedir}/target/classes" /&gt;
                  &lt;arg path="${basedir}/src/main/Foo.mapper" /&gt;
                &lt;/java&gt;
              &lt;/target&gt;
            &lt;/configuration&gt;
            &lt;goals&gt;
              &lt;goal&gt;run&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch05.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch07.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;5.&nbsp;Mapper files&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="manual.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;7.&nbsp;Usage</td></tr></table></div></body></html>